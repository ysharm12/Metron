You can still use frameworks like LangChain or PandasAI to let users ask natural language queries on a CSV (or DataFrame) and have backend code perform the calculations—even when your model is hosted on Azure OpenAI.

Below is an example using LangChain’s Pandas DataFrame Agent configured for Azure OpenAI:

---

### Using LangChain’s Pandas DataFrame Agent with Azure OpenAI

1. **Install the required packages:**

```bash
pip install langchain pandas openai
```

2. **Configure your Azure OpenAI model:**

LangChain provides an `AzureOpenAI` LLM class where you can set your endpoint, API key, deployment name, and version. For example:

```python
import pandas as pd
from langchain.llms import AzureOpenAI
from langchain.agents import create_pandas_dataframe_agent

# Load your CSV data into a DataFrame.
df = pd.read_csv("your_data.csv")

# Configure the Azure OpenAI model.
llm = AzureOpenAI(
    openai_api_base="https://<your-resource-name>.openai.azure.com/",
    openai_api_key="YOUR_API_KEY",
    deployment_name="YOUR_DEPLOYMENT_NAME",  # e.g., "gpt-4-deployment"
    model_name="gpt-4",  # or whichever model you are using
    openai_api_version="2024-02-01",  # use the version appropriate for your deployment
    temperature=0  # adjust temperature as needed
)

# Create a Pandas DataFrame Agent.
agent = create_pandas_dataframe_agent(llm, df, verbose=True)

# Now, you can ask any natural language query.
query = "Calculate the total revenue and average sales per month."
result = agent.run(query)
print(result)
```

---

### How It Works

- **Data Loading:**  
  Your CSV file is loaded into a Pandas DataFrame regardless of its schema. The agent will automatically inspect a few rows to understand the column names and types.

- **Azure OpenAI Integration:**  
  The `AzureOpenAI` class is used to configure your LLM to use the Azure-hosted model. Make sure you replace `<your-resource-name>`, `YOUR_API_KEY`, and `YOUR_DEPLOYMENT_NAME` with your actual Azure details.

- **Natural Language Query:**  
  The agent accepts any natural language query (like “calculate total revenue…”) and, behind the scenes, the LLM generates and executes the appropriate Pandas code to perform the calculation.

---

### Alternative: Using PandasAI with Azure OpenAI

If you prefer using [PandasAI](https://github.com/gventuri/pandas-ai), you might need to adjust its OpenAI LLM integration to point to your Azure endpoint. For example, you can configure the underlying `openai` package by setting:

```python
import openai
openai.api_type = "azure"
openai.api_base = "https://<your-resource-name>.openai.azure.com/"
openai.api_version = "2024-02-01"
openai.api_key = "YOUR_API_KEY"
```

Then, instantiate the PandasAI LLM wrapper and use it similarly to the LangChain approach.

---

### Summary

Both methods allow the user to simply provide a query without worrying about the CSV’s schema. The agent inspects a few rows to understand the structure and then dynamically generates code (using Pandas operations) to perform the requested calculations, with the LLM running on your Azure OpenAI deployment.

This gives you the flexibility to support any CSV schema and perform calculations based on natural language prompts while leveraging your Azure-hosted OpenAI model.
