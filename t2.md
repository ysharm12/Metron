import pandas as pd
from langchain_community.llms import AzureOpenAI
from langchain_experimental.agents import create_pandas_dataframe_agent

# Load your CSV data into a DataFrame.
df = pd.read_csv("FINAL_DATA_28JAN2025_29.csv")

# Configure the Azure OpenAI model.
llm = AzureOpenAI(
    openai_api_base="https://dycsb0qcdmbjek0openai.openai.azure.com/",
    openai_api_key="61708ba3ecb24abcbf691b8126feb905",
    deployment_name="o1-preview",  # e.g., "gpt-4-deployment"
    model_name="o1-preview",  # or whichever model you are using
    openai_api_version="2024-08-01-preview"
)

# Create a Pandas DataFrame Agent.
agent = create_pandas_dataframe_agent(llm, df, verbose=True, allow_dangerous=True)

# Now, you can ask any natural language query.
query = "Calculate the total revenue and average sales per month."
result = agent.run(query)
print(result)



ERROR:

"""
ysharm12@LAMU0LV129CJH2P app % python member.py
/Users/ysharm12/Documents/Metron/app/member.py:9: LangChainDeprecationWarning: The class `AzureOpenAI` was deprecated in LangChain 0.0.10 and will be removed in 1.0. An updated version of the class exists in the :class:`~langchain-openai package and should be used instead. To use it run `pip install -U :class:`~langchain-openai` and import as `from :class:`~langchain_openai import AzureOpenAI``.
  llm = AzureOpenAI(
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_community/llms/openai.py:889: UserWarning: As of openai>=1.0.0, Azure endpoints should be specified via the `azure_endpoint` param not `openai_api_base` (or alias `base_url`). Updating `openai_api_base` from https://dycsb0qcdmbjek0openai.openai.azure.com/ to https://dycsb0qcdmbjek0openai.openai.azure.com/openai.
  warnings.warn(
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_community/llms/openai.py:896: UserWarning: As of openai>=1.0.0, if `deployment_name` (or alias `azure_deployment`) is specified then `openai_api_base` (or alias `base_url`) should not be. Instead use `deployment_name` (or alias `azure_deployment`) and `azure_endpoint`.
  warnings.warn(
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_community/llms/openai.py:904: UserWarning: As of openai>=1.0.0, if `openai_api_base` (or alias `base_url`) is specified it is expected to be of the form https://example-resource.azure.openai.com/openai/deployments/example-deployment. Updating https://dycsb0qcdmbjek0openai.openai.azure.com/ to https://dycsb0qcdmbjek0openai.openai.azure.com/openai.
  warnings.warn(
Traceback (most recent call last):
  File "/Users/ysharm12/Documents/Metron/app/member.py", line 18, in <module>
    agent = create_pandas_dataframe_agent(llm, df, verbose=True, allow_dangerous=True)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_experimental/agents/agent_toolkits/pandas/base.py", line 249, in create_pandas_dataframe_agent
    raise ValueError(
ValueError: This agent relies on access to a python repl tool which can execute arbitrary code. This can be dangerous and requires a specially sandboxed environment to be safely used. Please read the security notice in the doc-string of this function. You must opt-in to use this functionality by setting allow_dangerous_code=True.For general security guidelines, please see: https://python.langchain.com/docs/security/
ysharm12@LAMU0LV129CJH2P app % 
"""
