This works there is just one issue figure that out


CODE:
"""
import duckdb
from openai import AzureOpenAI
import re

client = AzureOpenAI(
    api_version="2024-08-01-preview",
    azure_endpoint="https://dycsb0qcdmbjek0openai.openai.azure.com/",
    api_key="61708ba3ecb24abcbf691b8126feb905"
)
# Configure OpenAI to use your Azure OpenAI resource.
# openai.api_type = "azure"
# openai.api_base = "https://<your-resource-name>.openai.azure.com/"
# openai.api_version = "2024-08-01-preview"
# openai.api_key = "YOUR_API_KEY"

# Load CSV data into DuckDB (in-memory)
csv_path = "FINAL_DATA_28JAN2025_29.csv"
con = duckdb.connect(database=':memory:')
con.execute(f"CREATE TABLE data AS SELECT * FROM read_csv_auto('{csv_path}');")

# Get the table schema to inform the LLM
schema = con.execute("DESCRIBE data").fetchdf().to_string(index=False)

# Natural language query to convert into SQL
nl_query = "LOB = OH Care, Eligibility Date > 01/01/2025, "

# Construct a prompt to instruct the model
prompt = f"""
You are a SQL generator.
Given the following table schema:
{schema}

Write a SQL query that fulfills this request:
"{nl_query}"

Provide only the SQL query.
"""

# Call the Azure OpenAI API to generate the SQL query.
response = client.chat.completions.create(
                model="o1-preview",
                messages=[
                    {"role": "user", "content": prompt}
                ],
                timeout=300
            )

print(response)
raw_output = response.choices[0].message.content.strip()
print("Generated SQL Query:")
pattern = r"```sql(.*?)```"
match = re.search(pattern, raw_output, re.DOTALL)

sql_query = match.group(1).strip()
print(sql_query)

# Execute the generated SQL query using DuckDB
result = con.execute(sql_query).fetchdf()
print("Query Result:")
print(result)
"""


ERROR:
"""
ysharm12@LAMU0LV129CJH2P app % python member.py
ChatCompletion(id='chatcmpl-BAbjAbYquVu2y3M9w7ShqUkMswzk9', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content="```sql\nSELECT *\nFROM your_table\nWHERE lob = 'OH Care' AND Eligibility_Date > '2025-01-01';\n```", refusal=None, role='assistant', audio=None, function_call=None, tool_calls=None), content_filter_results={'hate': {'filtered': False, 'severity': 'safe'}, 'self_harm': {'filtered': False, 'severity': 'safe'}, 'sexual': {'filtered': False, 'severity': 'safe'}, 'violence': {'filtered': False, 'severity': 'safe'}})], created=1741868004, model='o1-preview-2024-09-12', object='chat.completion', service_tier=None, system_fingerprint='fp_772cb6e46d', usage=CompletionUsage(completion_tokens=643, prompt_tokens=1652, total_tokens=2295, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=576, rejected_prediction_tokens=0), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)), prompt_filter_results=[{'prompt_index': 0, 'content_filter_results': {'hate': {'filtered': False, 'severity': 'safe'}, 'jailbreak': {'filtered': False, 'detected': False}, 'self_harm': {'filtered': False, 'severity': 'safe'}, 'sexual': {'filtered': False, 'severity': 'safe'}, 'violence': {'filtered': False, 'severity': 'safe'}}}])
Generated SQL Query:
SELECT *
FROM your_table
WHERE lob = 'OH Care' AND Eligibility_Date > '2025-01-01';
Traceback (most recent call last):
  File "/Users/ysharm12/Documents/Metron/app/member.py", line 58, in <module>
    result = con.execute(sql_query).fetchdf()
             ^^^^^^^^^^^^^^^^^^^^^^
duckdb.duckdb.CatalogException: Catalog Error: Table with name your_table does not exist!
Did you mean "pg_tables"?

LINE 2: FROM your_table
             ^
ysharm12@LAMU0LV129CJH2P app % 
"""
